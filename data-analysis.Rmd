---
title: Traffic Data Analysis
output: html_document
---

```{r}
library(dplyr)
library(lubridate)
```

## Reading Data

```{r}
data = read.csv("all-semi-unique.csv")
dim(data)
names(data)
str(data)
summary(data)
```

Having a look on the first few rows of the data.

```{r}
head(data)
```

## Cleaning Data

### Processing Columns

Removing advertisements columns.

```{r}
data <- data %>% select(-starts_with("ad."))
ncol(data)
names(data)
```

Removing road images, colors and rode report images.

```{r}
data <- subset(data, select = -c(rd.img, rd.cl, rd.rp.rpImg, rd.rp.img))
ncol(data)
names(data)
```

Checking columns with constant features and printing their names.

```{r}
col_ct = sapply(data, function(x) length(unique(x)))
length(col_ct[col_ct == 1])
names(col_ct[col_ct == 1])
```

Removing constant-feature columns.

```{r}
data = data[, !names(data) %in% names(col_ct[col_ct == 1])]
ncol(data)
names(data)
```

### Processing Rows

Checking proportion of N/A values.

```{r}
sum(is.na(data)) / nrow(data) / ncol(data)
```

Checking number of duplicate rows.

```{r}
nrow(data) - nrow(unique(data))
```

Removing rows with same comment id.

```{r}
data <- data %>% distinct(rd.rp.cmid)
nrow(data)
```

## Feature Engineering

Formatting `crawl_date` into a proper `datetime` format and changing the timezone from `UTC` to `Egypt`.

```{r}
data$formatted_crawl_date <- as.POSIXct(data$crawl_date, format = "%a %b %d %T UTC %Y", tz = "UTC")
data$formatted_crawl_date <- as.POSIXct(c(data$formatted_crawl_date), tz = "Egypt")
head(data$crawl_date)
head(data$formatted_crawl_date)
str(data$formatted_crawl_date)
```

Adding `report_date` to the data frame.

```{r}
data$report_date <- data$formatted_crawl_date - hours(data$rd.rp.hr) - minutes(data$rd.rp.mn)
head(data$report_date)
```